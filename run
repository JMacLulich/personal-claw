#!/bin/bash

set -e

ensure_venv() {
    if [ ! -d ".venv" ]; then
        echo "Virtual environment not found. Run: python3 -m venv .venv"
        exit 1
    fi
    source .venv/bin/activate
}

usage() {
    echo "Usage: ./run <command>"
    echo "Commands:"
    echo "  lint fix   Run lint with auto-fix"
    echo "  lint       Run lint checks"
    echo "  test       Run tests"
}

if [ $# -lt 1 ]; then
    usage
    exit 1
fi

case "$1" in
    lint)
        ensure_venv
        if [ "$2" = "fix" ]; then
            python -m ruff check --fix .
        else
            python -m ruff check .
        fi
        ;;
    test)
        ensure_venv
        python -m pytest
        ;;
    *)
        usage
        exit 1
        ;;
esac
